import{H as e,D as t,E as o,R as n,S as a,B as s,M as i,G as r,m as c,a as d,b as l,c as p,d as u,L as y,V as m,A as w,C as f,e as g,f as h,g as x,h as v,i as b,W as A,P as D,O as S,j as K,k as R,F as M,l as P,n as z,o as W}from"./vendor.ddfd89fe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const E=new v,k=new b,L=new A({antialias:!0}),V=new D,B=[],O=new S(V,L.domElement);let C=1,G=window.innerWidth,T=window.innerHeight;const j=new f;let F=0;const I=new m(0,0,0),H=new m(2.5,15,25),_=()=>{G=window.innerWidth,T=window.innerHeight,N(),V.aspect=G/T,V.updateProjectionMatrix(),L.setSize(G,T),L.setPixelRatio(Math.min(window.devicePixelRatio,2)*C)},N=()=>{(G>1920||T>1080)&&(C=Math.min(1920/G,1080/T))};N(),V.fov=60,V.aspect=G/T,V.near=1,V.far=300,V.position.set(I.x+H.x,I.y+H.y,I.z+H.z),V.updateProjectionMatrix(),L.setSize(G,T),L.setPixelRatio(Math.min(window.devicePixelRatio,2)*C),L.shadowMap.enabled=!0,L.shadowMap.type=K,document.body.appendChild(L.domElement),k.background=new R(4502015),k.fog=new M(4502015,60,300),window.addEventListener("resize",_);const q=new P;q.showPanel(0),document.body.appendChild(q.dom),O.enableDamping=!0,O.dampingFactor=.05,O.screenSpacePanning=!1,O.minDistance=30,O.maxDistance=30,O.maxPolarAngle=75*Math.PI/180,O.enablePan=!1,O.enableZoom=!1,O.target=I;const Z=new W;!function(o){const n=new e(16777215,2236962,.5),a=new t(16777215,.7);a.position.set(1,1.5,1).multiplyScalar(100),a.shadow.mapSize.setScalar(3072),a.shadow.bias=-.001,a.shadow.normalBias=.05,a.castShadow=!0;const s=a.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,o.add(n,a)}(k),function(e,t,s){const i=new o(s),r=new n(e,t);i.addPass(r);const c=new a(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());i.addPass(c)}(k,V,L);const J=new z(Z),Q={};var U,X,Y,$,ee;X=k,Y=Q,$="islands/islands.gltf",ee="islands/islands_physics.gltf",(U=J).load($,(e=>{const t=e.scene,o=new s;o.setFromObject(t),o.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const n={};t.traverse((e=>{if(e instanceof i){const t=e.material.color.getHex();n[t]=n[t]||[],n[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const a=new r;for(const s in n){const e=n[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)a.attach(e);else{const o=e.geometry.clone();o.applyMatrix4(e.matrixWorld),t.push(o)}})),t.length){const e=c(t),o=new i(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));o.castShadow=!0,o.receiveShadow=!0,o.material.shadowSide=2,a.add(o)}}const u=[];a.updateMatrixWorld(!0),a.traverse((e=>{if(e instanceof i){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);u.push(t)}}));const y=c(u,!1);y.boundsTree=new l(y,{lazyGeneration:!1});const m=new i(y);m.material.wireframe=!0,m.material.opacity=.5,m.material.transparent=!0,m.userData.name="collider",Y[m.userData.name]=m,new p(m,1e3).visible=!0,X.add(t)}),void 0,(function(e){console.error(e)})),U.load(ee,(e=>{const t=e.scene;t.userData.name="floor",t.visible=!1,X.add(t),Y[t.userData.name]=t}),void 0,(function(e){console.error(e)}));const te={},{testAllKeys:oe,testAnyKeys:ne,keysFunctions:ae,checkPressedKeys:se,testAllButtons:ie,testAnyButton:re,testAxis:ce,checkPads:de,gamepads:le}=function(e){const t=[];let o=[];return window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1})),window.addEventListener("gamepadconnected",(e=>{console.log(e.gamepad.id,"podłączony")})),window.addEventListener("gamepaddisconnected",(e=>{console.log(e.gamepad.id,"odłączony")})),{testAllKeys:(t,o=null)=>{const n=t.every((t=>!0===e[t]));if(o){const t=o.every((t=>!1===e[t]||void 0===e[t]));return n&&t}return n},testAnyKeys:t=>t.some((t=>!0===e[t])),keysFunctions:t,checkPressedKeys:()=>{t.forEach((e=>{e()}))},testAllButtons:(e,t=null)=>{const n=e.every((e=>{var t;return null==(t=o[0])?void 0:t.buttons[e].pressed}));if(t){const e=t.every((e=>{var t;return!(null==(t=o[0])?void 0:t.buttons[e].pressed)}));return n&&e}return n},testAnyButton:e=>e.some((e=>{var t;return null==(t=o[0])?void 0:t.buttons[e].pressed})),testAxis:()=>{var e,t;if(o[0]){const n=.3,a=null==(e=o[0])?void 0:e.axes[0],s=null==(t=o[0])?void 0:t.axes[1],i={angle:180*Math.atan2(s,-a)/Math.PI-90,x:a,z:s};if(Math.abs(a)>n||Math.abs(s)>n)return i}},checkPads:()=>{o=navigator.getGamepads()},gamepads:o}}(te);B.push(se,de);const{robotRunning:pe,toAnimate:ue,lifes:ye,resetGame:me}=function(e,t,o,n,a,r,c,d,l,p,v,b,A,D,S,K,R,M,P){const z=new f;let W=!1;const E=new s,k=new u,L=new y,V=new m,B=new m,O=new m(0,1,0),C=new m;let G=3;const T=(new m).copy(K);let j=null;const F=(e,t)=>{const o=e.getClip().duration/e.getEffectiveTimeScale(),n=t.getClip().duration/t.getEffectiveTimeScale();return.25*n>o?o:.25*n},I=()=>{const e=o.collider,t=.1,n=o.Robot;0==n.userData.velocity.y&&C.set(n.position.x,n.position.y,n.position.z);let a=n.userData.speed;n.userData.velocity.y+=-.2,n.position.addScaledVector(n.userData.velocity,t);const i=2200==(null==j?void 0:j.loop),r=D.getAzimuthalAngle(),d=180*r/Math.PI;let l=180*o.Robot.rotation.y/Math.PI;!c(["ShiftLeft"])&&!p([7])||i||(a*=2),(c(["KeyW"],["KeyA","KeyS","KeyD"])||p([12],[13,14,15]))&&(V.set(0,0,-1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=180+d),(c(["KeyA"],["KeyW","KeyS","KeyD"])||p([14],[12,13,15]))&&(V.set(-1,0,0).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=-90+d),(c(["KeyS"],["KeyW","KeyA","KeyD"])||p([13],[12,14,15]))&&(V.set(0,0,1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=0+d),(c(["KeyD"],["KeyW","KeyA","KeyS"])||p([15],[12,13,14]))&&(V.set(1,0,0).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=90+d),(c(["KeyW","KeyA"])||p([12,14]))&&(V.set(-1,0,-1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=-135+d),(c(["KeyW","KeyD"])||p([12,15]))&&(V.set(1,0,-1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=135+d),(c(["KeyS","KeyA"])||p([13,14]))&&(V.set(-1,0,1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=-45+d),(c(["KeyS","KeyD"])||p([13,15]))&&(V.set(1,0,1).applyAxisAngle(O,r),n.position.addScaledVector(V,a*t),l=45+d),n.rotation.y=l*(Math.PI/180),n.updateMatrixWorld();const u=_(o.Robot);u.max.y,u.min.y,(new s).setFromObject(o.Robot),u.min.lerp(u.max,.5);const w=new y(new m(0,0,0),new m(0,0,0));E.makeEmpty(),k.copy(e.matrixWorld).invert(),L.copy(w),L.start.applyMatrix4(n.matrixWorld).applyMatrix4(k),L.end.applyMatrix4(n.matrixWorld).applyMatrix4(k),E.expandByPoint(L.start),E.expandByPoint(L.end),E.min.sub(new m(1.175,2.25,1.175)),E.max.sub(new m(-1.175,-2.25,-1.175)),e.geometry.boundsTree.shapecast(e,{intersectsBounds:e=>e.intersectsBox(E),intersectsTriangle:e=>{const t=e.closestPointToSegment(L,V,B);if(t<2.25){const e=2.25-t,o=B.sub(V).normalize();L.start.addScaledVector(o,e),L.end.addScaledVector(o,e)}}});const f=V;f.copy(L.start).applyMatrix4(e.matrixWorld);const g=B;g.subVectors(f,n.position),n.position.copy(f),n.userData.isOnGround=g.y>Math.abs(t*n.userData.velocity.y*.25),n.userData.isOnGround?n.userData.velocity.set(0,0,0):(g.normalize(),n.userData.velocity.addScaledVector(g,-g.dot(n.userData.velocity))),n.position.y<-40&&(n.userData.velocity.set(0,0,0),n.position.set(C.x,C.y,C.z),G--),x({targets:D.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:o.Robot.position.x,y:o.Robot.position.y,z:o.Robot.position.z})},H=()=>{if(a.Robot){if(d(["KeyW","KeyA","KeyS","KeyD"])||v([12,13,14,15])||b()){let e=1;(c(["ShiftLeft"])||p([7]))&&(e=2),((e,t,o,n=1,a=!0)=>{const s=t.find((e=>e.name===o)),i=e.clipAction(s);i.setEffectiveTimeScale(n),a||i.time!=i.getClip().duration||i.reset(),a||i==j||(W=!0,i.setLoop(g,1),i.setEffectiveWeight(1).reset(),null==j||j.fadeOut(F(j,i)),j=i),W?j&&j.time/j.getClip().duration>=.75&&(W=!1,i.fadeIn(F(i,j)).reset(),j=i):(i.setEffectiveWeight(1),j=i)})(a.Robot,n.Robot,"Robot_Running",e)}else((e,t,o)=>{const n=t.find((e=>e.name===o));e.clipAction(n).setEffectiveWeight(0)})(a.Robot,n.Robot,"Robot_Running");(d(["Space"])||p([0]))&&(W||0==o.Robot.userData.velocity.y&&(o.Robot.userData.velocity.y=5))}},_=e=>{const t=new h(e),o=new m(1/0,1/0,1/0),n=new m(-1/0,-1/0,-1/0);for(let a=0;a<t.bones.length;a++){const e=t.bones[a],s=new m;e.getWorldPosition(s),s.x<o.x&&(o.x=s.x),s.y<o.y&&(o.y=s.y),s.z<o.z&&(o.z=s.z),s.x>n.x&&(n.x=s.x),s.y>n.y&&(n.y=s.y),s.z>n.z&&(n.z=s.z)}return{min:o,max:n}};return e.load(A,(e=>{const s=e.scene;s.traverse((e=>{e instanceof i&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)})),s.userData.name="Robot",s.userData.isOnGround=!1,s.userData.velocity=new m(0,0,0),s.userData.speed=1.5,s.position.set(K.x,K.y,K.z),t.add(s),o[s.userData.name]=s,n[s.userData.name]=e.animations,a[s.userData.name]=new w(s),a[s.userData.name].addEventListener("finished",(function(e){W=!1,H()})),n[s.userData.name].forEach((e=>{a[s.userData.name].clipAction(e).setEffectiveWeight(0).play()}))}),void 0,(function(e){console.error(e)})),{robotRunning:H,toAnimate:()=>{for(const e in a)a[e].update(z.getDelta());o.Robot&&o.collider&&I(),(Object.values(r).includes(!0)||W||l[0])&&I()},lifes:G,resetGame:()=>{G=3;const e=o.Robot;e.userData.velocity.set(0,0,0),e.position.set(T.x,T.y,T.z),setTimeout((()=>{}),1e3)}}}(J,k,Q,{},{},te,oe,ne,le,ie,re,ce,"Robot_edited_centered.glb",O,0,I);B.push(ue),ae.push(pe);const we=()=>{q.begin();const e=j.getDelta();requestAnimationFrame(we),e>.022222222222222223?(()=>{switch(F){case 0:C=.75,_(),E.updateDisplay(),F=1;break;case 1:C=.5,_(),E.updateDisplay(),F=2}})():e<.017543859649122806&&(()=>{switch(F){case 1:C=1,_(),E.updateDisplay(),F=0;break;case 2:C=.75,_(),E.updateDisplay(),F=1}})();const t=Math.round(e/(1/60));for(let o=0;o<t;o++)B.forEach((e=>{e()})),O.update();L.render(k,V),q.end()};we();
