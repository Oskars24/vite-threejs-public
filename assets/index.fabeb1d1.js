import{H as e,D as t,E as a,R as o,S as n,B as s,M as i,G as r,m as c,a as d,b as l,c as p,d as u,L as y,V as m,A as w,C as f,e as g,f as h,g as v,h as b,W as x,P as D,O as A,i as S,j as K,F as M,k as P,l as R,n as W}from"./vendor.f7c7a92d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const E=new v,z=new b,F=new x({antialias:!0}),k=new D,V=[],L=new A(k,F.domElement),C={scaleFactor:1,popup:!1};let B=window.innerWidth,O=window.innerHeight;const j=new f;let G=0;const T=new m(0,0,0),I=new m(2.5,15,25),H=()=>{B=window.innerWidth,O=window.innerHeight,_(),k.aspect=B/O,k.updateProjectionMatrix(),F.setSize(B,O),F.setPixelRatio(Math.min(window.devicePixelRatio,2)*C.scaleFactor)},_=()=>{(B>1920||O>1080)&&(C.scaleFactor=Math.min(1920/B,1080/O))};_(),k.fov=60,k.aspect=B/O,k.near=1,k.far=300,k.position.set(T.x+I.x,T.y+I.y,T.z+I.z),k.updateProjectionMatrix(),F.setSize(B,O),F.setPixelRatio(Math.min(window.devicePixelRatio,2)*C.scaleFactor),F.shadowMap.enabled=!0,F.shadowMap.type=S,document.body.appendChild(F.domElement),z.background=new K(4502015),z.fog=new M(4502015,60,300),window.addEventListener("resize",H);const N=new P;N.showPanel(0),document.body.appendChild(N.dom),L.enableDamping=!0,L.dampingFactor=.05,L.screenSpacePanning=!1,L.minDistance=30,L.maxDistance=30,L.maxPolarAngle=75*Math.PI/180,L.enablePan=!1,L.enableZoom=!1,L.target=T;const q=new W;!function(a){const o=new e(16777215,2236962,.5),n=new t(16777215,.7);n.position.set(1,1.5,1).multiplyScalar(100),n.shadow.mapSize.setScalar(3072),n.shadow.bias=-.001,n.shadow.normalBias=.05,n.castShadow=!0;const s=n.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,a.add(o,n)}(z),function(e,t,s){const i=new a(s),r=new o(e,t);i.addPass(r);const c=new n(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());i.addPass(c)}(z,k,F);const U=new R(q),Z={};var J,Q,X,Y,$;Q=z,X=Z,Y="islands/islands.gltf",$="islands/islands_physics.gltf",(J=U).load(Y,(e=>{const t=e.scene,a=new s;a.setFromObject(t),a.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const o={};t.traverse((e=>{if(e instanceof i){const t=e.material.color.getHex();o[t]=o[t]||[],o[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const n=new r;for(const s in o){const e=o[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)n.attach(e);else{const a=e.geometry.clone();a.applyMatrix4(e.matrixWorld),t.push(a)}})),t.length){const e=c(t),a=new i(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));a.castShadow=!0,a.receiveShadow=!0,a.material.shadowSide=2,n.add(a)}}const u=[];n.updateMatrixWorld(!0),n.traverse((e=>{if(e instanceof i){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);u.push(t)}}));const y=c(u,!1);y.boundsTree=new l(y,{lazyGeneration:!1});const m=new i(y);m.material.wireframe=!0,m.material.opacity=.5,m.material.transparent=!0,m.userData.name="collider",X[m.userData.name]=m,new p(m,1e3).visible=!0,Q.add(t)}),void 0,(function(e){console.error(e)})),J.load($,(e=>{const t=e.scene;t.userData.name="floor",t.visible=!1,Q.add(t),X[t.userData.name]=t}),void 0,(function(e){console.error(e)}));const ee={},{testAllKeys:te,testAnyKeys:ae,keysFunctions:oe,checkPressedKeys:ne,testAllButtons:se,testAnyButton:ie,testAxis:re,checkPads:ce,gamepads:de}=function(e){const t=[];let a=[];return window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1})),window.addEventListener("gamepadconnected",(e=>{console.log(e.gamepad.id,"podłączony")})),window.addEventListener("gamepaddisconnected",(e=>{console.log(e.gamepad.id,"odłączony")})),{testAllKeys:(t,a=null)=>{const o=t.every((t=>!0===e[t]));if(a){const t=a.every((t=>!1===e[t]||void 0===e[t]));return o&&t}return o},testAnyKeys:t=>t.some((t=>!0===e[t])),keysFunctions:t,checkPressedKeys:()=>{t.forEach((e=>{e()}))},testAllButtons:(e,t=null)=>{const o=e.every((e=>{var t;return null==(t=a[0])?void 0:t.buttons[e].pressed}));if(t){const e=t.every((e=>{var t;return!(null==(t=a[0])?void 0:t.buttons[e].pressed)}));return o&&e}return o},testAnyButton:e=>e.some((e=>{var t;return null==(t=a[0])?void 0:t.buttons[e].pressed})),testAxis:()=>{var e,t;if(a[0]){const o=.3,n=null==(e=a[0])?void 0:e.axes[0],s=null==(t=a[0])?void 0:t.axes[1],i={angle:180*Math.atan2(s,-n)/Math.PI-90,x:n,z:s};if(Math.abs(n)>o||Math.abs(s)>o)return i}},checkPads:()=>{a=navigator.getGamepads()},gamepads:a}}(ee);V.push(ne,ce);const{robotRunning:le,toAnimate:pe,lifes:ue,resetGame:ye}=function(e,t,a,o,n,r,c,d,l,p,v,b,x,D,A,S,K,M,P){const R=new f;let W=!1;const E=new s,z=new u,F=new y,k=new m,V=new m,L=new m(0,1,0),C=new m;let B=3;const O=(new m).copy(S);let j=null;const G=(e,t)=>{const a=e.getClip().duration/e.getEffectiveTimeScale(),o=t.getClip().duration/t.getEffectiveTimeScale();return.25*o>a?a:.25*o},T=()=>{const e=a.collider,t=.1,o=a.Robot;0==o.userData.velocity.y&&C.set(o.position.x,o.position.y,o.position.z);let n=o.userData.speed;o.userData.velocity.y+=-.2,o.position.addScaledVector(o.userData.velocity,t);const s=2200==(null==j?void 0:j.loop),i=D.getAzimuthalAngle(),r=180*i/Math.PI;let d=180*a.Robot.rotation.y/Math.PI;!c(["ShiftLeft"])&&!p([7])||s||(n*=2),(c(["KeyW"],["KeyA","KeyS","KeyD"])||p([12],[13,14,15]))&&(k.set(0,0,-1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=180+r),(c(["KeyA"],["KeyW","KeyS","KeyD"])||p([14],[12,13,15]))&&(k.set(-1,0,0).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=-90+r),(c(["KeyS"],["KeyW","KeyA","KeyD"])||p([13],[12,14,15]))&&(k.set(0,0,1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=0+r),(c(["KeyD"],["KeyW","KeyA","KeyS"])||p([15],[12,13,14]))&&(k.set(1,0,0).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=90+r),(c(["KeyW","KeyA"])||p([12,14]))&&(k.set(-1,0,-1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=-135+r),(c(["KeyW","KeyD"])||p([12,15]))&&(k.set(1,0,-1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=135+r),(c(["KeyS","KeyA"])||p([13,14]))&&(k.set(-1,0,1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=-45+r),(c(["KeyS","KeyD"])||p([13,15]))&&(k.set(1,0,1).applyAxisAngle(L,i),o.position.addScaledVector(k,n*t),d=45+r),o.rotation.y=d*(Math.PI/180),o.updateMatrixWorld();const l=new y(new m(0,0,0),new m(0,0,0));E.makeEmpty(),z.copy(e.matrixWorld).invert(),F.copy(l),F.start.applyMatrix4(o.matrixWorld).applyMatrix4(z),F.end.applyMatrix4(o.matrixWorld).applyMatrix4(z),E.expandByPoint(F.start),E.expandByPoint(F.end),E.min.sub(new m(1.175,2.25,1.175)),E.max.sub(new m(-1.175,-2.25,-1.175)),e.geometry.boundsTree.shapecast(e,{intersectsBounds:e=>e.intersectsBox(E),intersectsTriangle:e=>{const t=e.closestPointToSegment(F,k,V);if(t<2.25){const e=2.25-t,a=V.sub(k).normalize();F.start.addScaledVector(a,e),F.end.addScaledVector(a,e)}}});const u=k;u.copy(F.start).applyMatrix4(e.matrixWorld);const w=V;w.subVectors(u,o.position),o.position.copy(u),o.userData.isOnGround=w.y>Math.abs(t*o.userData.velocity.y*.25),o.userData.isOnGround?o.userData.velocity.set(0,0,0):(w.normalize(),o.userData.velocity.addScaledVector(w,-w.dot(o.userData.velocity))),o.position.y<-40&&(o.userData.velocity.set(0,0,0),o.position.set(C.x,C.y,C.z),B--),h({targets:D.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:a.Robot.position.x,y:a.Robot.position.y,z:a.Robot.position.z})},I=()=>{if(n.Robot){if(d(["KeyW","KeyA","KeyS","KeyD"])||v([12,13,14,15])||b()){let e=1;(c(["ShiftLeft"])||p([7]))&&(e=2),((e,t,a,o=1,n=!0)=>{const s=t.find((e=>e.name===a)),i=e.clipAction(s);i.setEffectiveTimeScale(o),n||i.time!=i.getClip().duration||i.reset(),n||i==j||(W=!0,i.setLoop(g,1),i.setEffectiveWeight(1).reset(),null==j||j.fadeOut(G(j,i)),j=i),W?j&&j.time/j.getClip().duration>=.75&&(W=!1,i.fadeIn(G(i,j)).reset(),j=i):(i.setEffectiveWeight(1),j=i)})(n.Robot,o.Robot,"Robot_Running",e)}else((e,t,a)=>{const o=t.find((e=>e.name===a));e.clipAction(o).setEffectiveWeight(0)})(n.Robot,o.Robot,"Robot_Running");(d(["Space"])||p([0]))&&(W||0==a.Robot.userData.velocity.y&&(a.Robot.userData.velocity.y=5))}};return e.load(x,(e=>{const s=e.scene;s.traverse((e=>{e instanceof i&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)})),s.userData.name="Robot",s.userData.isOnGround=!1,s.userData.velocity=new m(0,0,0),s.userData.speed=1.5,s.position.set(S.x,S.y,S.z),t.add(s),a[s.userData.name]=s,o[s.userData.name]=e.animations,n[s.userData.name]=new w(s),n[s.userData.name].addEventListener("finished",(function(e){W=!1,I()})),o[s.userData.name].forEach((e=>{n[s.userData.name].clipAction(e).setEffectiveWeight(0).play()}))}),void 0,(function(e){console.error(e)})),{robotRunning:I,toAnimate:()=>{for(const e in n)n[e].update(R.getDelta());a.Robot&&a.collider&&T(),(Object.values(r).includes(!0)||W||l[0])&&T()},lifes:B,resetGame:()=>{B=3;const e=a.Robot;e.userData.velocity.set(0,0,0),e.position.set(O.x,O.y,O.z),setTimeout((()=>{}),1e3)}}}(U,z,Z,{},{},ee,te,ae,de,se,ie,re,"Robot_edited_centered.glb",L,0,T);V.push(pe),oe.push(le);const me={reset:()=>{ye()}},we=E.addFolder("Optymalizacja");we.open(),we.add(C,"scaleFactor",.05,1,.05).name("Scale Factor").onChange(H),we.add(F.shadowMap,"autoUpdate").name("Update shadows"),we.add(k,"far",60,500,10).name("Draw distance").setValue(300).onChange((()=>{z.fog.far=k.far,z.fog.near=k.far/3,k.updateProjectionMatrix()})),E.add(C,"popup").name("Pokaż sterowanie"),E.add(me,"reset").name("Reset position");const fe=()=>{N.begin();const e=j.getDelta();requestAnimationFrame(fe),e>.022222222222222223?(()=>{switch(G){case 0:C.scaleFactor=.75,H(),E.updateDisplay(),G=1;break;case 1:C.scaleFactor=.5,H(),E.updateDisplay(),G=2}})():e<.017543859649122806&&(()=>{switch(G){case 1:C.scaleFactor=1,H(),E.updateDisplay(),G=0;break;case 2:C.scaleFactor=.75,H(),E.updateDisplay(),G=1}})();const t=Math.round(e/(1/60));for(let a=0;a<t;a++)V.forEach((e=>{e()})),L.update();F.render(z,k),N.end()};fe();
