import{H as e,D as t,E as o,R as a,S as n,B as s,M as i,G as r,m as c,a as d,b as l,c as p,d as y,L as u,V as m,A as w,e as h,T as g,f,g as b,n as x,h as v,i as S,W as M,P,O as A,j as D,C as z,F as K,k as W,l as E,o as R,p as k}from"./vendor.5030e2c2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const F=new v,L=new S,T=new M({antialias:!0}),V=new P,O=[],j=new A(V,T.domElement),B={scaleFactor:1};let I=window.innerWidth,C=window.innerHeight;const G=new R;let H=0;const N=new m(70,0,-5),q=new m(2.5,15,25),J=()=>{I=window.innerWidth,C=window.innerHeight,U(),V.aspect=I/C,V.updateProjectionMatrix(),T.setSize(I,C),T.setPixelRatio(Math.min(window.devicePixelRatio,2)*B.scaleFactor)},U=()=>{(I>1920||C>1080)&&(B.scaleFactor=Math.min(1920/I,1080/C))};U(),V.fov=60,V.aspect=I/C,V.near=1,V.far=300,V.position.set(N.x+q.x,N.y+q.y,N.z+q.z),V.updateProjectionMatrix(),T.setSize(I,C),T.setPixelRatio(Math.min(window.devicePixelRatio,2)*B.scaleFactor),T.shadowMap.enabled=!0,T.shadowMap.type=D,document.body.appendChild(T.domElement),L.background=new z(4502015),L.fog=new K(4502015,60,300),window.addEventListener("resize",J);const Q=new W;Q.showPanel(0),document.body.appendChild(Q.dom),j.enableDamping=!0,j.dampingFactor=.05,j.screenSpacePanning=!1,j.minDistance=30,j.maxDistance=30,j.maxPolarAngle=75*Math.PI/180,j.enablePan=!1,j.enableZoom=!1,j.target=N;const Z=new k,{loading:_}=function(e){const t={loaded:0,total:0,progress:0};return e.onProgress=(e,o,a)=>{t.loaded=o,t.total=a,t.progress=Math.round(o/a*1e4)/100},{loading:t}}(Z);!function(o){const a=new e(16777215,2236962,.5),n=new t(16777215,.7);n.position.set(1,1.5,1).multiplyScalar(100),n.shadow.mapSize.setScalar(3072),n.shadow.bias=-.001,n.shadow.normalBias=.05,n.castShadow=!0;const s=n.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,o.add(a,n)}(L),function(e,t,s){const i=new o(s),r=new a(e,t);i.addPass(r);const c=new n(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());i.addPass(c)}(L,V,T);const X=new E(Z),Y={};var $,ee,te;$=L,ee=Y,te="islands/islands.gltf",X.load(te,(e=>{const t=e.scene,o=new s;o.setFromObject(t),o.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const a={};t.traverse((e=>{if(e instanceof i){const t=e.material.color.getHex();a[t]=a[t]||[],a[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const n=new r;for(const s in a){const e=a[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)n.attach(e);else{const o=e.geometry.clone();o.applyMatrix4(e.matrixWorld),t.push(o)}})),t.length){const e=c(t),o=new i(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));o.castShadow=!0,o.receiveShadow=!0,o.material.shadowSide=2,n.add(o)}}const y=[];n.updateMatrixWorld(!0),n.traverse((e=>{if(e instanceof i){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);y.push(t)}}));const u=c(y,!1);u.boundsTree=new l(u,{lazyGeneration:!1});const m=new i(u);m.material.wireframe=!0,m.material.opacity=.5,m.material.transparent=!0,m.userData.name="collider",ee[m.userData.name]=m,new p(m,1e3).visible=!0,$.add(t)}),void 0,(function(e){console.error(e)}));const oe={},ae={};!function(e,t){window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1}));const o=x.create({zone:document.querySelector(".joystick"),mode:"static",restJoystick:!0,position:{left:"100px",bottom:"100px"},color:"white"}).on("move",((e,o)=>{for(const a in o)t[a]=o[a]})).on("end",(()=>{t.force=0,t.pressure=0,t.distance=0,t.vector.x=0,t.vector.y=0}));t.size=o.options.size}(oe,ae);const{checkKeysState:ne}=function(e,t,o,a,n,r,c){const d=new s,l=new y,p=new u,x=new m,v=new m,S=new m(0,1,0);let M=null,P=null,A={},D=null,z=!1,K=!1;e.load("character/character.gltf",(e=>{const n=e.scene;n.traverse((e=>{e instanceof i&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=1)})),n.userData.name="Robot",n.userData.isOnGround=!1,n.userData.velocity=new m(0,0,0),n.userData.speed=7,n.userData.gravity=-150,n.position.set(o.x,o.y,o.z),t.add(n),a[n.userData.name]=n,D=new w(n),D.addEventListener("finished",(function(e){e.action.loop===h&&(z=!1)})),e.animations.forEach((e=>{A[e.name]=e}))}),void 0,(function(e){console.error(e)}));const W=(e,t=1,o=b)=>{if(P&&P.setEffectiveTimeScale(t),M==e||z)return;const a=A[e];if(void 0!==a){const t=D.clipAction(a);t.reset(),M=e,o===h&&(z=!0,t.setLoop(h,1)),t.play(),P&&P.crossFadeTo(t,.25),P=t}};return{checkKeysState:e=>{if(e=e<.1?e:.016,D&&D.update(e),!a.Robot|!a.collider)return;const t=a.collider,o=a.Robot;let{speed:s,gravity:i,velocity:y,isOnGround:w}=o.userData,b=o.position.clone(),M=x.clone(),A=v.clone(),z=y.clone(),E=1;y.y+=w?0:e*i,o.position.addScaledVector(y,e);const R=c.getAzimuthalAngle(),k=180*R/Math.PI;let F=180*o.rotation.y/Math.PI;if(n.ShiftLeft?(s*=2.7,K=!0):K=!1,n.KeyW&&(x.set(0,0,-1).applyAxisAngle(S,R),o.position.addScaledVector(x,s*e),F=180+k),n.KeyA&&(x.set(-1,0,0).applyAxisAngle(S,R),o.position.addScaledVector(x,s*e),F=-90+k),n.KeyS&&(x.set(0,0,1).applyAxisAngle(S,R),o.position.addScaledVector(x,s*e),F=0+k),n.KeyD&&(x.set(1,0,0).applyAxisAngle(S,R),o.position.addScaledVector(x,s*e),F=90+k),n.KeyW&&n.KeyA&&(F=-135+k),n.KeyW&&n.KeyD&&(F=135+k),n.KeyS&&n.KeyA&&(F=-45+k),n.KeyS&&n.KeyD&&(F=45+k),r.vector){const t=r.distance/(.5*r.size);t>0&&(E=t>.5?t:.5,F=r.angle.degree-270+k,t>.85?(s*=2.7,K=!0):K=!1,x.set(r.vector.x,0,-r.vector.y).applyAxisAngle(S,R),o.position.addScaledVector(x,s*e))}n.KeyW||n.KeyA||n.KeyS||n.KeyD||r.vector&&(0!=r.vector.x||0!=r.vector.y)?W(K?"Run":"Walk",E):W("Idle"),o.rotation.y=F*(Math.PI/180),o.updateMatrixWorld();let L=1.175;const T=new u(new m(0,0,0),new m(0,0,0));d.makeEmpty(),l.copy(t.matrixWorld).invert(),p.copy(T),p.start.applyMatrix4(o.matrixWorld).applyMatrix4(l),p.end.applyMatrix4(o.matrixWorld).applyMatrix4(l),d.expandByPoint(p.start),d.expandByPoint(p.end),d.min.sub(new m(1.175,3.375,1.175)),d.max.sub(new m(-1.175,-3.375,-1.175));let V=[],O=0,j=0,B=[],I=0,C=0;if(t.geometry.boundsTree.shapecast(t,{intersectsBounds:e=>e.intersectsBox(d),intersectsTriangle:e=>{const t=e.closestPointToSegment(p,x,v);if(t<L){const o=new g(e.a.clone(),e.b.clone(),e.c.clone());o.closest=x.clone(),B.push(o);let a=L-t;const n=v.sub(x).normalize();p.start.addScaledVector(n,a),p.end.addScaledVector(n,a)}}}),B.length>1&&B.forEach((e=>{const t=e.getNormal(new m).angleTo(new m(0,1,0))*(180/Math.PI);t>60&&(I=t,C=Math.abs(Math.abs(e.closest.y)-Math.abs(d.min.y)))})),t.geometry.boundsTree.shapecast(t,{intersectsBounds:e=>e.intersectsBox(d),intersectsTriangle:t=>{const o=t.closestPointToSegment(p,x,v);if(o<3.375){const a=new g(t.a.clone(),t.b.clone(),t.c.clone());a.closest=x.clone(),V.push(a);const n=3.375-o,s=v.sub(x).normalize();s.y<e&&(s.y=Math.abs(s.y)),p.start.y+=s.y*n,p.end.y+=s.y*n}}}),V.length>1&&V.forEach((e=>{const t=e.getNormal(new m).angleTo(new m(0,1,0))*(180/Math.PI);t>60&&(O=t,j=Math.abs(Math.abs(e.closest.y)-Math.abs(d.min.y)))})),O>60&&j>L||I>60&&C>L)V.length&&(o.position.y=b.y,x.y=M.y,v.y=A.y,y.y=z.y),B.length&&(o.position.copy(b),x.copy(M),v.copy(A),y.copy(z));else{const a=x;a.copy(p.start).applyMatrix4(t.matrixWorld);const n=v;n.subVectors(a,o.position),o.position.copy(a),w=n.y>Math.abs(e*y.y*.25),w?y.set(0,0,0):(n.normalize(),y.addScaledVector(n,-n.dot(y)))}n.Space&&(W("Jump",1,h),0===y.y&&f({targets:y,easing:"easeOutQuint",duration:P._clip.duration,y:50})),o.position.y<-40&&(a.Robot.userData.velocity.set(0,0,0),a.Robot.position.set(70,0,-5),c.update()),Object.assign(o.userData,{velocity:y,isOnGround:w}),f({targets:c.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:a.Robot.position.x,y:a.Robot.position.y,z:a.Robot.position.z})}}}(X,L,N,Y,oe,ae,j),se=F.addFolder("Optymalizacja");se.open(),se.add(B,"scaleFactor",.05,1,.05).name("Scale Factor").onChange(J),se.add(T.shadowMap,"autoUpdate").name("Update shadows"),se.add(V,"far",60,500,10).name("Draw distance").setValue(300).onChange((()=>{L.fog.far=V.far,L.fog.near=V.far/3,V.updateProjectionMatrix()})),document.addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState?G.stop():G.start()}));const ie=()=>{Q.begin(),100!=_.progress||(H=G.getDelta()),requestAnimationFrame(ie);const e=Math.round(H/(1/60));for(let t=0;t<e;t++)O.forEach((e=>{e()})),ne(H),j.update();T.render(L,V),Q.end()};ie();
