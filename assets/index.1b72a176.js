import{H as e,D as t,E as a,R as o,S as n,B as s,M as i,G as r,m as c,a as d,b as l,c as p,d as u,L as y,V as w,A as m,e as f,n as h,f as g,g as x,W as v,P as S,O as b,h as D,C as M,F as P,i as A,j as K,k as z,l as W}from"./vendor.c980d850.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const R=new g,E=new x,F=new v({antialias:!0}),V=new S,k=[],L=new b(V,F.domElement),j={scaleFactor:1};let O=window.innerWidth,C=window.innerHeight;const B=new W;let I=0;const T=new w(0,0,0),G=new w(2.5,15,25),H=()=>{O=window.innerWidth,C=window.innerHeight,_(),V.aspect=O/C,V.updateProjectionMatrix(),F.setSize(O,C),F.setPixelRatio(Math.min(window.devicePixelRatio,2)*j.scaleFactor)},_=()=>{(O>1920||C>1080)&&(j.scaleFactor=Math.min(1920/O,1080/C))};_(),V.fov=60,V.aspect=O/C,V.near=1,V.far=300,V.position.set(T.x+G.x,T.y+G.y,T.z+G.z),V.updateProjectionMatrix(),F.setSize(O,C),F.setPixelRatio(Math.min(window.devicePixelRatio,2)*j.scaleFactor),F.shadowMap.enabled=!0,F.shadowMap.type=D,document.body.appendChild(F.domElement),E.background=new M(4502015),E.fog=new P(4502015,60,300),window.addEventListener("resize",H);const q=new A;q.showPanel(0),document.body.appendChild(q.dom),L.enableDamping=!0,L.dampingFactor=.05,L.screenSpacePanning=!1,L.minDistance=30,L.maxDistance=30,L.maxPolarAngle=75*Math.PI/180,L.enablePan=!1,L.enableZoom=!1,L.target=T;const N=new z;!function(a){const o=new e(16777215,2236962,.5),n=new t(16777215,.7);n.position.set(1,1.5,1).multiplyScalar(100),n.shadow.mapSize.setScalar(3072),n.shadow.bias=-.001,n.shadow.normalBias=.05,n.castShadow=!0;const s=n.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,a.add(o,n)}(E),function(e,t,s){const i=new a(s),r=new o(e,t);i.addPass(r);const c=new n(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());i.addPass(c)}(E,V,F);const U=new K(N),J={};var Z,Q,X,Y,$;Q=E,X=J,Y="islands/islands.gltf",$="islands/islands_physics.gltf",(Z=U).load(Y,(e=>{const t=e.scene,a=new s;a.setFromObject(t),a.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const o={};t.traverse((e=>{if(e instanceof i){const t=e.material.color.getHex();o[t]=o[t]||[],o[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const n=new r;for(const s in o){const e=o[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)n.attach(e);else{const a=e.geometry.clone();a.applyMatrix4(e.matrixWorld),t.push(a)}})),t.length){const e=c(t),a=new i(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));a.castShadow=!0,a.receiveShadow=!0,a.material.shadowSide=2,n.add(a)}}const u=[];n.updateMatrixWorld(!0),n.traverse((e=>{if(e instanceof i){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);u.push(t)}}));const y=c(u,!1);y.boundsTree=new l(y,{lazyGeneration:!1});const w=new i(y);w.material.wireframe=!0,w.material.opacity=.5,w.material.transparent=!0,w.userData.name="collider",X[w.userData.name]=w,new p(w,1e3).visible=!0,Q.add(t)}),void 0,(function(e){console.error(e)})),Z.load($,(e=>{const t=e.scene;t.userData.name="floor",t.visible=!1,Q.add(t),X[t.userData.name]=t}),void 0,(function(e){console.error(e)}));const ee={},te={};!function(e,t){window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1}));const a=h.create({zone:document.querySelector(".joystick"),mode:"static",restJoystick:!0,position:{left:"50%",bottom:"100px"},color:"white"}).on("move",((e,a)=>{for(const o in a)t[o]=a[o]})).on("end",(()=>{t.force=0,t.pressure=0,t.distance=0,t.vector.x=0,t.vector.y=0}));t.size=a.options.size}(ee,te);const{checkKeysState:ae}=function(e,t,a,o,n,r,c){const d=new s,l=new u,p=new y,h=new w,g=new w,x=new w(0,1,0);let v=null,S=null,b={},D=null;e.load("Robot_edited_centered.glb",(e=>{const n=e.scene;n.traverse((e=>{e instanceof i&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=1)})),n.userData.name="Robot",n.userData.isOnGround=!1,n.userData.velocity=new w(0,0,0),n.userData.speed=15,n.userData.gravity=-30,n.position.set(a.x,a.y,a.z),t.add(n),o[n.userData.name]=n,D=new m(n),e.animations.forEach((e=>{b[e.name]=e}))}),void 0,(function(e){console.error(e)}));const M=(e,t=1)=>{if(S&&S.setEffectiveTimeScale(t),v==e)return;const a=b[e];if(void 0!==a){const t=D.clipAction(a);t.reset(),v=e,t.play(),S&&S.crossFadeTo(t,.25),S=t}};return{checkKeysState:e=>{if(e=e<.25?e:.016,D&&D.update(e),!o.Robot|!o.collider)return;const t=o.collider,a=o.Robot;let{speed:s,gravity:i,velocity:u}=a.userData,m=1;u.y+=e*i,a.position.addScaledVector(u,e);const v=c.getAzimuthalAngle(),S=180*v/Math.PI;let b=180*a.rotation.y/Math.PI;if(n.ShiftLeft&&(s*=2,m*=2),n.KeyW&&(h.set(0,0,-1).applyAxisAngle(x,v),a.position.addScaledVector(h,s*e),b=180+S),n.KeyA&&(h.set(-1,0,0).applyAxisAngle(x,v),a.position.addScaledVector(h,s*e),b=-90+S),n.KeyS&&(h.set(0,0,1).applyAxisAngle(x,v),a.position.addScaledVector(h,s*e),b=0+S),n.KeyD&&(h.set(1,0,0).applyAxisAngle(x,v),a.position.addScaledVector(h,s*e),b=90+S),n.KeyW&&n.KeyA&&(b=-135+S),n.KeyW&&n.KeyD&&(b=135+S),n.KeyS&&n.KeyA&&(b=-45+S),n.KeyS&&n.KeyD&&(b=45+S),r.vector){const t=r.distance/(.5*r.size);t>0&&(m=t>.5?t:.5,b=r.angle.degree-270+S,t>.85&&(s*=2,m*=2),h.set(r.vector.x,0,-r.vector.y).applyAxisAngle(x,v),a.position.addScaledVector(h,s*e))}n.KeyW||n.KeyA||n.KeyS||n.KeyD||r.vector&&(0!=r.vector.x||0!=r.vector.y)?M("Robot_Running",m):M("Robot_Idle"),a.rotation.y=b*(Math.PI/180),a.updateMatrixWorld();const P=new y(new w(0,0,0),new w(0,0,0));d.makeEmpty(),l.copy(t.matrixWorld).invert(),p.copy(P),p.start.applyMatrix4(a.matrixWorld).applyMatrix4(l),p.end.applyMatrix4(a.matrixWorld).applyMatrix4(l),d.expandByPoint(p.start),d.expandByPoint(p.end),d.min.sub(new w(1.175,2.25,1.175)),d.max.sub(new w(-1.175,-2.25,-1.175)),t.geometry.boundsTree.shapecast(t,{intersectsBounds:e=>e.intersectsBox(d),intersectsTriangle:e=>{const t=e.closestPointToSegment(p,h,g);if(t<2.25){let e=2.25-t;const a=g.sub(h).normalize();p.start.addScaledVector(a,e),p.end.addScaledVector(a,e)}}});const A=h;A.copy(p.start).applyMatrix4(t.matrixWorld);const K=g;K.subVectors(A,a.position),a.position.copy(A),a.userData.isOnGround=K.y>Math.abs(e*a.userData.velocity.y*.25),a.userData.isOnGround?a.userData.velocity.set(0,0,0):(K.normalize(),a.userData.velocity.addScaledVector(K,-K.dot(a.userData.velocity))),n.Space&&0==u.y&&(u.y=15),f({targets:c.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:o.Robot.position.x,y:o.Robot.position.y,z:o.Robot.position.z})}}}(U,E,T,J,ee,te,L),oe=R.addFolder("Optymalizacja");oe.open(),oe.add(j,"scaleFactor",.05,1,.05).name("Scale Factor").onChange(H),oe.add(F.shadowMap,"autoUpdate").name("Update shadows"),oe.add(V,"far",60,500,10).name("Draw distance").setValue(300).onChange((()=>{E.fog.far=V.far,E.fog.near=V.far/3,V.updateProjectionMatrix()}));const ne=()=>{q.begin(),I=B.getDelta(),requestAnimationFrame(ne),ae(I);const e=Math.round(I/(1/60));for(let t=0;t<e;t++)k.forEach((e=>{e()})),L.update();F.render(E,V),q.end()};ne();
