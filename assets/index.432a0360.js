import{H as e,D as t,E as a,R as o,S as n,B as s,M as i,G as r,m as c,a as d,b as l,c as p,d as u,L as y,V as m,A as w,C as f,e as g,f as h,g as x,h as v,i as b,W as D,P as A,O as S,j as K,k as R,F as M,l as P,n as z,o as W}from"./vendor.ddfd89fe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const E=new v,F=new b,k=new D({antialias:!0}),V=new A,L=[],C=new S(V,k.domElement),O={scaleFactor:1,popup:!1};let B=window.innerWidth,j=window.innerHeight;const G=new f;let T=0;const I=new m(0,0,0),H=new m(2.5,15,25),_=()=>{B=window.innerWidth,j=window.innerHeight,N(),V.aspect=B/j,V.updateProjectionMatrix(),k.setSize(B,j),k.setPixelRatio(Math.min(window.devicePixelRatio,2)*O.scaleFactor)},N=()=>{(B>1920||j>1080)&&(O.scaleFactor=Math.min(1920/B,1080/j))};N(),V.fov=60,V.aspect=B/j,V.near=1,V.far=300,V.position.set(I.x+H.x,I.y+H.y,I.z+H.z),V.updateProjectionMatrix(),k.setSize(B,j),k.setPixelRatio(Math.min(window.devicePixelRatio,2)*O.scaleFactor),k.shadowMap.enabled=!0,k.shadowMap.type=K,document.body.appendChild(k.domElement),F.background=new R(4502015),F.fog=new M(4502015,60,300),window.addEventListener("resize",_);const q=new P;q.showPanel(0),document.body.appendChild(q.dom),C.enableDamping=!0,C.dampingFactor=.05,C.screenSpacePanning=!1,C.minDistance=30,C.maxDistance=30,C.maxPolarAngle=75*Math.PI/180,C.enablePan=!1,C.enableZoom=!1,C.target=I;const U=new W;!function(a){const o=new e(16777215,2236962,.5),n=new t(16777215,.7);n.position.set(1,1.5,1).multiplyScalar(100),n.shadow.mapSize.setScalar(3072),n.shadow.bias=-.001,n.shadow.normalBias=.05,n.castShadow=!0;const s=n.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,a.add(o,n)}(F),function(e,t,s){const i=new a(s),r=new o(e,t);i.addPass(r);const c=new n(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());i.addPass(c)}(F,V,k);const Z=new z(U),J={};var Q,X,Y,$,ee;X=F,Y=J,$="islands/islands.gltf",ee="islands/islands_physics.gltf",(Q=Z).load($,(e=>{const t=e.scene,a=new s;a.setFromObject(t),a.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const o={};t.traverse((e=>{if(e instanceof i){const t=e.material.color.getHex();o[t]=o[t]||[],o[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const n=new r;for(const s in o){const e=o[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)n.attach(e);else{const a=e.geometry.clone();a.applyMatrix4(e.matrixWorld),t.push(a)}})),t.length){const e=c(t),a=new i(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));a.castShadow=!0,a.receiveShadow=!0,a.material.shadowSide=2,n.add(a)}}const u=[];n.updateMatrixWorld(!0),n.traverse((e=>{if(e instanceof i){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);u.push(t)}}));const y=c(u,!1);y.boundsTree=new l(y,{lazyGeneration:!1});const m=new i(y);m.material.wireframe=!0,m.material.opacity=.5,m.material.transparent=!0,m.userData.name="collider",Y[m.userData.name]=m,new p(m,1e3).visible=!0,X.add(t)}),void 0,(function(e){console.error(e)})),Q.load(ee,(e=>{const t=e.scene;t.userData.name="floor",t.visible=!1,X.add(t),Y[t.userData.name]=t}),void 0,(function(e){console.error(e)}));const te={},{testAllKeys:ae,testAnyKeys:oe,keysFunctions:ne,checkPressedKeys:se,testAllButtons:ie,testAnyButton:re,testAxis:ce,checkPads:de,gamepads:le}=function(e){const t=[];let a=[];return window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1})),window.addEventListener("gamepadconnected",(e=>{console.log(e.gamepad.id,"podłączony")})),window.addEventListener("gamepaddisconnected",(e=>{console.log(e.gamepad.id,"odłączony")})),{testAllKeys:(t,a=null)=>{const o=t.every((t=>!0===e[t]));if(a){const t=a.every((t=>!1===e[t]||void 0===e[t]));return o&&t}return o},testAnyKeys:t=>t.some((t=>!0===e[t])),keysFunctions:t,checkPressedKeys:()=>{t.forEach((e=>{e()}))},testAllButtons:(e,t=null)=>{const o=e.every((e=>{var t;return null==(t=a[0])?void 0:t.buttons[e].pressed}));if(t){const e=t.every((e=>{var t;return!(null==(t=a[0])?void 0:t.buttons[e].pressed)}));return o&&e}return o},testAnyButton:e=>e.some((e=>{var t;return null==(t=a[0])?void 0:t.buttons[e].pressed})),testAxis:()=>{var e,t;if(a[0]){const o=.3,n=null==(e=a[0])?void 0:e.axes[0],s=null==(t=a[0])?void 0:t.axes[1],i={angle:180*Math.atan2(s,-n)/Math.PI-90,x:n,z:s};if(Math.abs(n)>o||Math.abs(s)>o)return i}},checkPads:()=>{a=navigator.getGamepads()},gamepads:a}}(te);L.push(se,de);const{robotRunning:pe,toAnimate:ue,lifes:ye,resetGame:me}=function(e,t,a,o,n,r,c,d,l,p,v,b,D,A,S,K,R,M,P){const z=new f;let W=!1;const E=new s,F=new u,k=new y,V=new m,L=new m,C=new m(0,1,0),O=new m;let B=3;const j=(new m).copy(K);let G=null;const T=(e,t)=>{const a=e.getClip().duration/e.getEffectiveTimeScale(),o=t.getClip().duration/t.getEffectiveTimeScale();return.25*o>a?a:.25*o},I=()=>{const e=a.collider,t=.1,o=a.Robot;0==o.userData.velocity.y&&O.set(o.position.x,o.position.y,o.position.z);let n=o.userData.speed;o.userData.velocity.y+=-.2,o.position.addScaledVector(o.userData.velocity,t);const i=2200==(null==G?void 0:G.loop),r=A.getAzimuthalAngle(),d=180*r/Math.PI;let l=180*a.Robot.rotation.y/Math.PI;!c(["ShiftLeft"])&&!p([7])||i||(n*=2),(c(["KeyW"],["KeyA","KeyS","KeyD"])||p([12],[13,14,15]))&&(V.set(0,0,-1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=180+d),(c(["KeyA"],["KeyW","KeyS","KeyD"])||p([14],[12,13,15]))&&(V.set(-1,0,0).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=-90+d),(c(["KeyS"],["KeyW","KeyA","KeyD"])||p([13],[12,14,15]))&&(V.set(0,0,1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=0+d),(c(["KeyD"],["KeyW","KeyA","KeyS"])||p([15],[12,13,14]))&&(V.set(1,0,0).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=90+d),(c(["KeyW","KeyA"])||p([12,14]))&&(V.set(-1,0,-1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=-135+d),(c(["KeyW","KeyD"])||p([12,15]))&&(V.set(1,0,-1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=135+d),(c(["KeyS","KeyA"])||p([13,14]))&&(V.set(-1,0,1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=-45+d),(c(["KeyS","KeyD"])||p([13,15]))&&(V.set(1,0,1).applyAxisAngle(C,r),o.position.addScaledVector(V,n*t),l=45+d),o.rotation.y=l*(Math.PI/180),o.updateMatrixWorld();const u=_(a.Robot);u.max.y,u.min.y,(new s).setFromObject(a.Robot),u.min.lerp(u.max,.5);const w=new y(new m(0,0,0),new m(0,0,0));E.makeEmpty(),F.copy(e.matrixWorld).invert(),k.copy(w),k.start.applyMatrix4(o.matrixWorld).applyMatrix4(F),k.end.applyMatrix4(o.matrixWorld).applyMatrix4(F),E.expandByPoint(k.start),E.expandByPoint(k.end),E.min.sub(new m(1.175,2.25,1.175)),E.max.sub(new m(-1.175,-2.25,-1.175)),e.geometry.boundsTree.shapecast(e,{intersectsBounds:e=>e.intersectsBox(E),intersectsTriangle:e=>{const t=e.closestPointToSegment(k,V,L);if(t<2.25){const e=2.25-t,a=L.sub(V).normalize();k.start.addScaledVector(a,e),k.end.addScaledVector(a,e)}}});const f=V;f.copy(k.start).applyMatrix4(e.matrixWorld);const g=L;g.subVectors(f,o.position),o.position.copy(f),o.userData.isOnGround=g.y>Math.abs(t*o.userData.velocity.y*.25),o.userData.isOnGround?o.userData.velocity.set(0,0,0):(g.normalize(),o.userData.velocity.addScaledVector(g,-g.dot(o.userData.velocity))),o.position.y<-40&&(o.userData.velocity.set(0,0,0),o.position.set(O.x,O.y,O.z),B--),x({targets:A.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:a.Robot.position.x,y:a.Robot.position.y,z:a.Robot.position.z})},H=()=>{if(n.Robot){if(d(["KeyW","KeyA","KeyS","KeyD"])||v([12,13,14,15])||b()){let e=1;(c(["ShiftLeft"])||p([7]))&&(e=2),((e,t,a,o=1,n=!0)=>{const s=t.find((e=>e.name===a)),i=e.clipAction(s);i.setEffectiveTimeScale(o),n||i.time!=i.getClip().duration||i.reset(),n||i==G||(W=!0,i.setLoop(g,1),i.setEffectiveWeight(1).reset(),null==G||G.fadeOut(T(G,i)),G=i),W?G&&G.time/G.getClip().duration>=.75&&(W=!1,i.fadeIn(T(i,G)).reset(),G=i):(i.setEffectiveWeight(1),G=i)})(n.Robot,o.Robot,"Robot_Running",e)}else((e,t,a)=>{const o=t.find((e=>e.name===a));e.clipAction(o).setEffectiveWeight(0)})(n.Robot,o.Robot,"Robot_Running");(d(["Space"])||p([0]))&&(W||0==a.Robot.userData.velocity.y&&(a.Robot.userData.velocity.y=5))}},_=e=>{const t=new h(e),a=new m(1/0,1/0,1/0),o=new m(-1/0,-1/0,-1/0);for(let n=0;n<t.bones.length;n++){const e=t.bones[n],s=new m;e.getWorldPosition(s),s.x<a.x&&(a.x=s.x),s.y<a.y&&(a.y=s.y),s.z<a.z&&(a.z=s.z),s.x>o.x&&(o.x=s.x),s.y>o.y&&(o.y=s.y),s.z>o.z&&(o.z=s.z)}return{min:a,max:o}};return e.load(D,(e=>{const s=e.scene;s.traverse((e=>{e instanceof i&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)})),s.userData.name="Robot",s.userData.isOnGround=!1,s.userData.velocity=new m(0,0,0),s.userData.speed=1.5,s.position.set(K.x,K.y,K.z),t.add(s),a[s.userData.name]=s,o[s.userData.name]=e.animations,n[s.userData.name]=new w(s),n[s.userData.name].addEventListener("finished",(function(e){W=!1,H()})),o[s.userData.name].forEach((e=>{n[s.userData.name].clipAction(e).setEffectiveWeight(0).play()}))}),void 0,(function(e){console.error(e)})),{robotRunning:H,toAnimate:()=>{for(const e in n)n[e].update(z.getDelta());a.Robot&&a.collider&&I(),(Object.values(r).includes(!0)||W||l[0])&&I()},lifes:B,resetGame:()=>{B=3;const e=a.Robot;e.userData.velocity.set(0,0,0),e.position.set(j.x,j.y,j.z),setTimeout((()=>{}),1e3)}}}(Z,F,J,{},{},te,ae,oe,le,ie,re,ce,"Robot_edited_centered.glb",C,0,I);L.push(ue),ne.push(pe);const we={reset:()=>{me()}},fe=E.addFolder("Optymalizacja");fe.open(),fe.add(O,"scaleFactor",.05,1,.05).name("Scale Factor").onChange(_),fe.add(k.shadowMap,"autoUpdate").name("Update shadows"),fe.add(V,"far",60,500,10).name("Draw distance").setValue(300).onChange((()=>{F.fog.far=V.far,F.fog.near=V.far/3,V.updateProjectionMatrix()})),E.add(O,"popup").name("Pokaż sterowanie"),E.add(we,"reset").name("Reset position");const ge=()=>{q.begin();const e=G.getDelta();requestAnimationFrame(ge),e>.022222222222222223?(()=>{switch(T){case 0:O.scaleFactor=.75,_(),E.updateDisplay(),T=1;break;case 1:O.scaleFactor=.5,_(),E.updateDisplay(),T=2}})():e<.017543859649122806&&(()=>{switch(T){case 1:O.scaleFactor=1,_(),E.updateDisplay(),T=0;break;case 2:O.scaleFactor=.75,_(),E.updateDisplay(),T=1}})();const t=Math.round(e/(1/60));for(let a=0;a<t;a++)L.forEach((e=>{e()})),C.update();k.render(F,V),q.end()};ge();
