import{H as e,D as t,E as a,R as o,S as n,B as s,M as r,G as i,m as c,a as d,b as l,c as p,d as m,e as u,f as y,g as h,h as w,i as g,V as f,j as x,A as b,L as S,k as v,l as M,n as P,o as D,p as A,q as z,W,P as K,O as T,r as E,C as V,F as k,s as B,t as F,u as L,v as O}from"./vendor.ec0a5dd2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const C=document.querySelector(".info");let j=null;const q=new A,I=new z,R=new W({antialias:!0}),G=new K,H=[],N=new T(G,R.domElement),Q={scaleFactor:1};let J=window.innerWidth,U=window.innerHeight;const $=new L;let Z=0;const _=new f(-20,-6.5,10),X=new f(2.5,15,25),Y=()=>{J=window.innerWidth,U=window.innerHeight,ee(),G.aspect=J/U,G.updateProjectionMatrix(),R.setSize(J,U),R.setPixelRatio(Math.min(window.devicePixelRatio,2)*Q.scaleFactor)},ee=()=>{(J>1920||U>1080)&&(Q.scaleFactor=Math.min(1920/J,1080/U))};ee(),G.fov=60,G.aspect=J/U,G.near=1,G.far=300,G.position.set(_.x+X.x,_.y+X.y,_.z+X.z),G.updateProjectionMatrix(),R.setSize(J,U),R.setPixelRatio(Math.min(window.devicePixelRatio,2)*Q.scaleFactor),R.shadowMap.enabled=!0,R.shadowMap.type=E,document.body.appendChild(R.domElement),I.background=new V(4502015),I.fog=new k(4502015,60,300),window.addEventListener("resize",Y);const te=new B;te.showPanel(0),document.body.appendChild(te.dom),N.enableDamping=!0,N.dampingFactor=.05,N.screenSpacePanning=!1,N.minDistance=30,N.maxDistance=30,N.maxPolarAngle=75*Math.PI/179.99,N.enablePan=!1,N.enableZoom=!1,N.target=_;const ae=new O,{loading:oe}=function(e){const t={loaded:0,total:0,progress:0};return e.onProgress=(e,a,o)=>{t.loaded=a,t.total=o,t.progress=Math.round(a/o*1e4)/100},{loading:t}}(ae);!function(a){const o=new e(16777215,2236962,.5),n=new t(16777215,.7);n.position.set(1,1.5,1).multiplyScalar(100),n.shadow.mapSize.setScalar(3072),n.shadow.bias=-.001,n.shadow.normalBias=.05,n.castShadow=!0;const s=n.shadow.camera;s.bottom=s.left=-300,s.top=300,s.right=300,a.add(o,n)}(I),function(e,t,s){const r=new a(s),i=new o(e,t);r.addPass(i);const c=new n(window.innerWidth*s.getPixelRatio(),window.innerHeight*s.getPixelRatio());r.addPass(c)}(I,G,R);const ne=new F(ae),se={};var re,ie,ce;re=I,ie=se,ce="islands/islands.gltf",ne.load(ce,(e=>{const t=e.scene,a=new s;a.setFromObject(t),a.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const o={};t.traverse((e=>{if(e instanceof r){const t=e.material.color.getHex();o[t]=o[t]||[],o[t].push(e),e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2}}));const n=new i;for(const s in o){const e=o[s],t=[];if(e.forEach((e=>{if(0!==e.material.emissive.r)n.attach(e);else{const a=e.geometry.clone();a.applyMatrix4(e.matrixWorld),t.push(a)}})),t.length){const e=c(t),a=new r(e,new d({color:16777215,opacity:0,transparent:!0,depthWrite:!1}));a.castShadow=!0,a.receiveShadow=!0,a.material.shadowSide=2,n.add(a)}}const m=[];n.updateMatrixWorld(!0),n.traverse((e=>{if(e instanceof r){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);m.push(t)}}));const u=c(m,!1);u.boundsTree=new l(u,{lazyGeneration:!1});const y=new r(u);y.material.wireframe=!0,y.material.opacity=.5,y.material.transparent=!0,y.userData.name="stateCollider",ie[y.userData.name]=y,new p(y,1e3).visible=!0,re.add(t)}),void 0,(function(e){console.error(e)})),function(e,t,a,o){m.prototype.computeBoundsTree=u,m.prototype.disposeBoundsTree=y,r.prototype.raycast=h;const n=new w({color:2565162}),s=new g(5,5,8);a.randomboxes=[];for(let i=0;i<Math.sqrt(36);i++)for(let e=0;e<Math.sqrt(36);e++){const o=new r(s,n);o.position.x=20-10*i+(5*Math.random()-.5)+25,o.position.y=-6,o.position.z=20-10*e+(5*Math.random()-.5)+25,o.name=`box-${i*Math.sqrt(36)+e}`,o.geometry.computeBoundsTree(),a.randomboxes.push(o),t.add(o)}}(0,I,se);const de={},le={};!function(e,t){window.addEventListener("keydown",(t=>{e[t.code]=!0})),window.addEventListener("keyup",(t=>{e[t.code]=!1}));const a=D.create({zone:document.querySelector(".joystick"),mode:"static",restJoystick:!0,position:{left:"100px",bottom:"100px"},color:"white"}).on("move",((e,a)=>{for(const o in a)t[o]=a[o]})).on("end",(()=>{t.force=0,t.pressure=0,t.distance=0,t.vector.x=0,t.vector.y=0}));t.size=a.options.size}(de,le);const{checkKeysState:pe}=function(e,t,a,o,n,i,d){const p=new f(0,1,0);let m=null,u=null,y={},h=null,w=!1,g=!1;const D={};e.load("character/character.gltf",(e=>{const n=e.scene;n.traverse((e=>{e instanceof r&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=1)})),n.userData.name="Player",n.userData.isOnGround=!1,n.userData.velocity=new f(0,0,0),n.userData.width=2.35,n.userData.height=6.75,n.userData.speed=7,n.userData.gravity=-150,n.position.set(a.x,a.y,a.z),n.children[0].applyMatrix4((new x).makeTranslation(0,-n.userData.width/2,0)),t.add(n),o[n.userData.name]=n,h=new b(n),h.addEventListener("finished",(function(e){e.action.loop===S&&(w=!1)})),e.animations.forEach((e=>{y[e.name]=e}))}),void 0,(function(e){console.error(e)}));const A=(e,t=1,a=M)=>{if(u&&u.setEffectiveTimeScale(t),m==e||w)return;const o=y[e];if(void 0!==o){const t=h.clipAction(o);t.reset(),m=e,a===S&&(w=!0,t.setLoop(S,1)),t.play(),u&&u.crossFadeTo(t,.25),u=t}},z=new s,W=new f,K=new f;return{checkKeysState:e=>{if(e=e<.1?e:.016,h&&h.update(e),!o.Player|!o.stateCollider)return;const t=o.stateCollider,a=o.Player;let{speed:s,gravity:m,velocity:y,isOnGround:w}=a.userData,b=1;y.y+=w?0:e*m,a.position.addScaledVector(y,e);const M=d.getAzimuthalAngle(),T=180*M/Math.PI;let E=180*a.rotation.y/Math.PI;if(n.ShiftLeft?(s*=2.7,g=!0):g=!1,n.KeyW&&(W.set(0,0,-1).applyAxisAngle(p,M),a.position.addScaledVector(W,s*e),E=180+T),n.KeyA&&(W.set(-1,0,0).applyAxisAngle(p,M),a.position.addScaledVector(W,s*e),E=-90+T),n.KeyS&&(W.set(0,0,1).applyAxisAngle(p,M),a.position.addScaledVector(W,s*e),E=0+T),n.KeyD&&(W.set(1,0,0).applyAxisAngle(p,M),a.position.addScaledVector(W,s*e),E=90+T),n.KeyW&&n.KeyA&&(E=-135+T),n.KeyW&&n.KeyD&&(E=135+T),n.KeyS&&n.KeyA&&(E=-45+T),n.KeyS&&n.KeyD&&(E=45+T),i.vector){const t=i.distance/(.5*i.size);t>0&&(b=t>.5?t:.5,E=i.angle.degree-270+T,t>.85?(s*=2.7,g=!0):g=!1,W.set(i.vector.x,0,-i.vector.y).applyAxisAngle(p,M),a.position.addScaledVector(W,s*e))}performance.now();const V=[];o.randomboxes.forEach((e=>{const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const a in t.attributes)"position"!==a&&t.deleteAttribute(a);V.push(t)}));const k=c(V,!1);k.boundsTree=new l(k,{lazyGeneration:!1});const B=new r(k);performance.now(),n.KeyW||n.KeyA||n.KeyS||n.KeyD||i.vector&&(0!=i.vector.x||0!=i.vector.y)?A(g?"Run":"Walk",b):A("Idle"),a.rotation.y=E*(Math.PI/180),a.updateMatrixWorld(),performance.now();const F=[];o.randomboxes.forEach((e=>{const t=(new x).copy(e.matrixWorld).invert();e.geometry.boundsTree.intersectsBox(z,t)&&(e.distance=z.min.distanceTo(e.position),F.push(e))})),performance.now(),F.length>1&&F.sort(((e,t)=>e.distance-t.distance)),!j||0!==F.length&&F[0].name==j.name||D[j.name]||v({targets:j.position,easing:"easeOutQuint",duration:1e3,y:-6}),F.length&&(v({targets:F[0].position,easing:"easeOutQuint",duration:1e3,y:-3,begin:()=>{D[F[0].name]=!0},complete:()=>{D[F[0].name]=!1}}),j=F[0]),C.textContent=F.length?`${F[0].name}`:"";const L=((e,t,a)=>{const{width:o,height:n}=a.userData;let s=o/2;const r=new P(new f(0,0,0),new f(0,n-o,0));z.makeEmpty(),(new x).copy(e.matrixWorld).invert();const i=new P;return i.copy(r),i.start.applyMatrix4(a.matrixWorld),i.end.applyMatrix4(a.matrixWorld),z.expandByPoint(i.start),z.expandByPoint(i.end),z.min.sub(new f(o/2,o/2,o/2)),z.max.sub(new f(-o/2,-o/2,-o/2)),e.geometry.boundsTree.shapecast({intersectsBounds:e=>e.intersectsBox(z),intersectsTriangle:e=>{const t=e.closestPointToSegment(i,W,K);if(t<s){let a=s-t;const n=K.sub(W).normalize(),r=e.getNormal(new f).angleTo(p)*(180/Math.PI),c=Math.abs(Math.abs(W.y)-Math.abs(z.min.y));r>60&&c>o/4&&(n.y=0),i.start.addScaledVector(n,a),i.end.addScaledVector(n,a)}}}),t.geometry.boundsTree.shapecast({intersectsBounds:e=>e.intersectsBox(z),intersectsTriangle:e=>{const t=e.closestPointToSegment(i,W,K);if(t<s){let a=s-t;const n=K.sub(W).normalize(),r=e.getNormal(new f).angleTo(p)*(180/Math.PI),c=Math.abs(Math.abs(W.y)-Math.abs(z.min.y));r>60&&c>o/2&&(n.y=0),i.start.addScaledVector(n,a),i.end.addScaledVector(n,a)}}}),i.start.clone().applyMatrix4(e.matrixWorld)})(t,B,a);K.subVectors(L,a.position),a.position.copy(L),w=K.y>Math.abs(e*y.y*.25);const O=Math.max(0,K.length()-1e-5);K.normalize().multiplyScalar(O),w?y.set(0,0,0):(K.normalize(),y.addScaledVector(K,-K.dot(y))),n.Space&&(A("Jump",1,S),0===y.y&&v({targets:y,easing:"easeOutQuint",duration:u._clip.duration,y:50})),a.position.y<-40&&(o.Player.userData.velocity.set(0,0,0),o.Player.position.set(-20,0,10),d.update()),Object.assign(a.userData,{velocity:y,isOnGround:w}),v({targets:d.target,easing:"easeOutCirc",duration:2e3,complete:()=>{},x:o.Player.position.x,y:o.Player.position.y,z:o.Player.position.z})}}}(ne,I,_,se,de,le,N),me=q.addFolder("Optymalizacja");me.open(),me.add(Q,"scaleFactor",.05,1,.05).name("Scale Factor").onChange(Y),me.add(R.shadowMap,"autoUpdate").name("Update shadows"),me.add(G,"far",60,500,10).name("Draw distance").setValue(300).onChange((()=>{I.fog.far=G.far,I.fog.near=G.far/3,G.updateProjectionMatrix()})),document.addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState?$.stop():$.start()}));const ue=()=>{te.begin(),100!=oe.progress||(Z=$.getDelta()),requestAnimationFrame(ue);const e=Math.round(Z/(1/60));for(let t=0;t<e;t++)H.forEach((e=>{e()})),pe(Z),N.update();se.randomboxes&&se.randomboxes.forEach((e=>{e.rotation.y+=Z*Math.random()})),R.render(I,G),te.end()};ue();
